<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>å†…å­˜æœç´¢</title>
    <url>/2023/05/12/%E5%86%85%E5%AD%98%E6%9F%A5%E6%89%BE/</url>
    <content><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯å†…å­˜æœç´¢ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å†…å­˜æœç´¢ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å†…å­˜æœç´¢ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å†…å­˜æœç´¢ï¼Ÿ</h2><p>æŸ¥æ‰¾æŒ‡å®šå†…å­˜åŒºæ®µæ˜¯å¦å­˜åœ¨æŒ‡å®šçš„å€¼ã€‚</p>
<h2 id="å†…å­˜æœç´¢åŸç†æ˜¯å•¥ï¼Ÿ"><a href="#å†…å­˜æœç´¢åŸç†æ˜¯å•¥ï¼Ÿ" class="headerlink" title="å†…å­˜æœç´¢åŸç†æ˜¯å•¥ï¼Ÿ"></a>å†…å­˜æœç´¢åŸç†æ˜¯å•¥ï¼Ÿ</h2><p>ä»ç›®æ ‡å†…å­˜åŒºæ®µèµ·å§‹åœ°å€åˆ°å†…å­˜åŒºæ®µç»“æŸä½ç½®å»åˆ¤æ–­å…¶ä¸­æ˜¯å¦æœ‰æ»¡è¶³æˆ‘ä»¬æ¡ä»¶çš„å€¼ï¼Œæœ‰åˆ™æœç´¢åˆ°äº†ç›®æ ‡åœ°å€ã€‚</p>
<h2 id="å†…å­˜æœç´¢çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å†…å­˜æœç´¢çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å†…å­˜æœç´¢çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å†…å­˜æœç´¢çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>1.æ¶æ„ç¨‹åºç‰¹å¾æå–ï¼›</p>
<p>2.ç‰¹æ®Šå˜é‡è·å–ï¼›</p>
<p>3.è·å–æœªå…¬å¼€å‡½æ•°åœ°å€ï¼›</p>
<p>4.and so on.</p>
<h1 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h1><p>è·å–Windows 7 x86çš„PspCidTableå€¼ï¼š</p>
<p>é€šè¿‡windbgæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>dd PspCidTable</code>å‘½ä»¤è·å–åˆ°å…¨å±€å¥æŸ„è¡¨ç›¸å…³ç»“æ„<code>HANDLE_TABLE</code>çš„åœ°å€ï¼Œä½†æ˜¯æˆ‘ä»¬å†™ ä»£ç çš„è¿‡ç¨‹ä¸­å´æ²¡åŠæ³•é€šè¿‡è¿™ä¸ªå‘½ä»¤æ‹¿åˆ°PspCidTableçš„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–¹æ³•å°±æ˜¯é€šè¿‡å­—èŠ‚ç‰¹å¾ç å»æŸ¥æ‰¾åˆ°è¿™ä¸ªå€¼ï¼Œé€šè¿‡å®éªŒå‘ç°åœ¨<code>PsLookupProcessByProcessId</code>è¿™ä¸ªå‡½æ•°é€šè¿‡è¿›ç¨‹idæŸ¥æ‰¾è¿›ç¨‹çš„eprocessæ—¶ä½¿ç”¨åˆ°äº†è¿™ä¸ªPspCidTable,é‚£æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åœ¨é©±åŠ¨åŠ è½½çš„æ—¶å€™å»æŸ¥æ‰¾è¿™ä¸ªå‡½æ•°åœ°å€å¼•ç”¨é‚£å—æ•°æ®ï¼Œä»è€Œä¾¿å¯ä»¥æ‰¾åˆ°æˆ‘ä»¬çš„PspCidTableäº†ã€‚</p>
<p>å…ˆçœ‹çœ‹PsLookupProcessByProcessIdå‡½æ•°çš„ç‰¹å¾ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">PAGE:006696E9                                                 var_C= dword ptr -0Ch</span><br><span class="line">PAGE:006696E9                                                 var_8= dword ptr -8</span><br><span class="line">PAGE:006696E9                                                 var_4= dword ptr -4</span><br><span class="line">PAGE:006696E9                                                 ProcessId= dword ptr  8</span><br><span class="line">PAGE:006696E9                                                 Process= dword ptr  0Ch</span><br><span class="line">PAGE:006696E9</span><br><span class="line">PAGE:006696E9 8B FF                                           mov     edi, edi</span><br><span class="line">PAGE:006696EB 55                                              push    ebp</span><br><span class="line">PAGE:006696EC 8B EC                                           mov     ebp, esp</span><br><span class="line">PAGE:006696EE 83 EC 0C                                        sub     esp, 0Ch</span><br><span class="line">PAGE:006696F1 53                                              push    ebx</span><br><span class="line">PAGE:006696F2 56                                              push    esi</span><br><span class="line">PAGE:006696F3 64 8B 35 24 01 00 00                            mov     esi, large fs:124h</span><br><span class="line">PAGE:006696FA 33 DB                                           xor     ebx, ebx</span><br><span class="line">PAGE:006696FC 66 FF 8E 84 00 00 00                            dec     word ptr [esi+84h]</span><br><span class="line">PAGE:00669703 57                                              push    edi</span><br><span class="line">PAGE:00669704 FF 75 08                                        push    [ebp+ProcessId]</span><br><span class="line">PAGE:00669707 8B 3D 94 DD 54 00                               mov     edi, _PspCidTable</span><br><span class="line">PAGE:0066970D E8 21 52 FE FF                                  call    _ExMapHandleToPointer@8         ; ExMapHandleToPointer(x,x)</span><br></pre></td></tr></table></figure></div>

<p>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ° <code>mov edi, _PspCidTable</code>è¿™ä¸ªæŒ‡ä»¤ä½¿ç”¨åˆ°äº†PspCidTableçš„å€¼ï¼Œä½†æ˜¯è¿™ä¸ªå€¼ä¸æ˜¯å›ºå®šçš„ï¼Œæ˜¯è¿è¡Œæ—¶æ‰èƒ½å¾—åˆ°å€¼çš„ï¼Œæ‰€ä»¥å’±ä»¬éœ€è¦ç”¨ç›¸é‚»çš„å­—èŠ‚ç‰¹å¾æ¥æ‰¾åˆ°è¿™ä¸ªPspCidTableçš„å€¼ï¼Œé‚£å’±ä»¬å°±ç”¨call _ExMapHandleToPointerç‰¹å¾æŸ¥æ‰¾ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">E8 21 52 FE FF           call    _ExMapHandleToPointer@8</span><br></pre></td></tr></table></figure></div>

<p>å½“ç„¶æˆ‘é€‰ç”¨ä¸Šé¢è¿™æ®µæŒ‡ä»¤çš„ç‰¹å¾æ²¡å»ç¡®å®šæœ‰æ²¡æœ‰å…¶ä»–åœ°æ–¹ä¹Ÿè°ƒç”¨äº†è¿™æ®µæŒ‡ä»¤ï¼Œä½†æ˜¯æˆ‘å°±æ˜¯å¤´é“æˆ‘å°±è¦é€‰å®ƒï¼Œä½ ä»¬ä¹Ÿå¯ä»¥é€‰åˆ™push ediä¸Šé¢é‚£æ¡æŒ‡ä»¤ï¼Œç‰¹å¾æ€§ç›¸å¯¹æ¥è¯´æ¯”æˆ‘é€‰çš„è¿™ä¸ªå¼ºï¼Œå¥½äº†ï¼Œæˆ‘ä»¥è¿™ä¸ªä¾‹å­æ¥è¯´ä¸€ä¸‹ä»£ç æ€è·¯ï¼Œä¹Ÿæ˜¯æš´åŠ›æœç´¢æ€è·¯ï¼š</p>
<p>1.è·å–PsLookupProcessByProcessIdæ‰€åœ¨æ¨¡å—åœ°å€å’Œæ¨¡å—å¤§å°ï¼Œæ¨¡å—åä¸ºâ€œntkrnlpa.exeâ€ï¼Œæ¨¡å—åœ°å€ä¾¿æ˜¯å†…å­˜æœç´¢èµ·å§‹åœ°å€ï¼Œæ¨¡å—åœ°å€+æ¨¡å—å¤§å°ä¾¿æ˜¯æœç´¢ç»“æŸåœ°å€ï¼›</p>
<p>2.ä»æœç´¢èµ·å§‹åœ°å€ä¸åœåˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸€å—è¿ç»­å†…å­˜æ˜¯ç¬¦åˆæˆ‘ä»¬ç‰¹å¾çš„æ˜¯çš„è¯å°±æ‰¾åˆ°äº†ï¼Œè¿”å›è¿™ä¸ªåœ°å€ï¼›</p>
<p>3.PspCidTableåœ°å€å 4ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡ç‰¹å¾æ‹¿åˆ°çš„åœ°å€å‡å»4ä¸ªå­—èŠ‚å°±å¾—åˆ°äº†PspCidTableçš„åœ°å€äº†ï¼›</p>
<p><strong>å¥‰ä¸Šä»£ç ï¼š</strong></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">#include &lt;ntifs.h&gt;</span><br><span class="line"></span><br><span class="line">typedef struct _RTL_PROCESS_MODULE_INFORMATION &#123;</span><br><span class="line">        HANDLE Section;                 // Not filled in</span><br><span class="line">        PVOID MappedBase;</span><br><span class="line">        PVOID ImageBase;</span><br><span class="line">        ULONG ImageSize;</span><br><span class="line">        ULONG Flags;</span><br><span class="line">        USHORT LoadOrderIndex;</span><br><span class="line">        USHORT InitOrderIndex;</span><br><span class="line">        USHORT LoadCount;</span><br><span class="line">        USHORT OffsetToFileName;</span><br><span class="line">        UCHAR  FullPathName[256];</span><br><span class="line">&#125; RTL_PROCESS_MODULE_INFORMATION, *PRTL_PROCESS_MODULE_INFORMATION;</span><br><span class="line">typedef struct _RTL_PROCESS_MODULES &#123;</span><br><span class="line">        ULONG NumberOfModules;</span><br><span class="line">        RTL_PROCESS_MODULE_INFORMATION Modules[1];</span><br><span class="line">&#125; RTL_PROCESS_MODULES, *PRTL_PROCESS_MODULES;</span><br><span class="line">typedef enum _SYSTEM_INFORMATION_CLASS &#123;</span><br><span class="line">        SystemBasicInformation,</span><br><span class="line">        SystemProcessorInformation,             // obsolete...delete</span><br><span class="line">        SystemPerformanceInformation,</span><br><span class="line">        SystemTimeOfDayInformation,</span><br><span class="line">        SystemPathInformation,</span><br><span class="line">        SystemProcessInformation,</span><br><span class="line">        SystemCallCountInformation,</span><br><span class="line">        SystemDeviceInformation,</span><br><span class="line">        SystemProcessorPerformanceInformation,</span><br><span class="line">        SystemFlagsInformation,</span><br><span class="line">        SystemCallTimeInformation,</span><br><span class="line">        SystemModuleInformation,</span><br><span class="line">        SystemLocksInformation,</span><br><span class="line">        SystemStackTraceInformation,</span><br><span class="line">        SystemPagedPoolInformation,</span><br><span class="line">        SystemNonPagedPoolInformation,</span><br><span class="line">        SystemHandleInformation,</span><br><span class="line">        SystemObjectInformation,</span><br><span class="line">        SystemPageFileInformation,</span><br><span class="line">        SystemVdmInstemulInformation,</span><br><span class="line">        SystemVdmBopInformation,</span><br><span class="line">        SystemFileCacheInformation,</span><br><span class="line">        SystemPoolTagInformation,</span><br><span class="line">        SystemInterruptInformation,</span><br><span class="line">        SystemDpcBehaviorInformation,</span><br><span class="line">        SystemFullMemoryInformation,</span><br><span class="line">        SystemLoadGdiDriverInformation,</span><br><span class="line">        SystemUnloadGdiDriverInformation,</span><br><span class="line">        SystemTimeAdjustmentInformation,</span><br><span class="line">        SystemSummaryMemoryInformation,</span><br><span class="line">        SystemMirrorMemoryInformation,</span><br><span class="line">        SystemPerformanceTraceInformation,</span><br><span class="line">        SystemObsolete0,</span><br><span class="line">        SystemExceptionInformation,</span><br><span class="line">        SystemCrashDumpStateInformation,</span><br><span class="line">        SystemKernelDebuggerInformation,</span><br><span class="line">        SystemContextSwitchInformation,</span><br><span class="line">        SystemRegistryQuotaInformation,</span><br><span class="line">        SystemExtendServiceTableInformation,</span><br><span class="line">        SystemPrioritySeperation,</span><br><span class="line">        SystemVerifierAddDriverInformation,</span><br><span class="line">        SystemVerifierRemoveDriverInformation,</span><br><span class="line">        SystemProcessorIdleInformation,</span><br><span class="line">        SystemLegacyDriverInformation,</span><br><span class="line">        SystemCurrentTimeZoneInformation,</span><br><span class="line">        SystemLookasideInformation,</span><br><span class="line">        SystemTimeSlipNotification,</span><br><span class="line">        SystemSessionCreate,</span><br><span class="line">        SystemSessionDetach,</span><br><span class="line">        SystemSessionInformation,</span><br><span class="line">        SystemRangeStartInformation,</span><br><span class="line">        SystemVerifierInformation,</span><br><span class="line">        SystemVerifierThunkExtend,</span><br><span class="line">        SystemSessionProcessInformation,</span><br><span class="line">        SystemLoadGdiDriverInSystemSpace,</span><br><span class="line">        SystemNumaProcessorMap,</span><br><span class="line">        SystemPrefetcherInformation,</span><br><span class="line">        SystemExtendedProcessInformation,</span><br><span class="line">        SystemRecommendedSharedDataAlignment,</span><br><span class="line">        SystemComPlusPackage,</span><br><span class="line">        SystemNumaAvailableMemory,</span><br><span class="line">        SystemProcessorPowerInformation,</span><br><span class="line">        SystemEmulationBasicInformation,</span><br><span class="line">        SystemEmulationProcessorInformation,</span><br><span class="line">        SystemExtendedHandleInformation,</span><br><span class="line">        SystemLostDelayedWriteInformation,</span><br><span class="line">        SystemBigPoolInformation,</span><br><span class="line">        SystemSessionPoolTagInformation,</span><br><span class="line">        SystemSessionMappedViewInformation,</span><br><span class="line">        SystemHotpatchInformation,</span><br><span class="line">        SystemObjectSecurityMode,</span><br><span class="line">        SystemWatchdogTimerHandler,</span><br><span class="line">        SystemWatchdogTimerInformation,</span><br><span class="line">        SystemLogicalProcessorInformation,</span><br><span class="line">        SystemWow64SharedInformation,</span><br><span class="line">        SystemRegisterFirmwareTableInformationHandler,</span><br><span class="line">        SystemFirmwareTableInformation,</span><br><span class="line">        SystemModuleInformationEx,</span><br><span class="line">        SystemVerifierTriageInformation,</span><br><span class="line">        SystemSuperfetchInformation,</span><br><span class="line">        SystemMemoryListInformation,</span><br><span class="line">        SystemFileCacheInformationEx,</span><br><span class="line">        MaxSystemInfoClass  // MaxSystemInfoClass should always be the last enum</span><br><span class="line">&#125; SYSTEM_INFORMATION_CLASS;</span><br><span class="line"></span><br><span class="line">NTSYSAPI NTSTATUS NTAPI ZwQuerySystemInformation(</span><br><span class="line">        __in SYSTEM_INFORMATION_CLASS SystemInformationClass,</span><br><span class="line">        __out_bcount_opt(SystemInformationLength) PVOID SystemInformation,</span><br><span class="line">        __in ULONG SystemInformationLength,</span><br><span class="line">        __out_opt PULONG ReturnLength</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">ULONG_PTR GetKernelModuleBase(PUCHAR moduleName, PULONG pModuleSize) &#123;</span><br><span class="line">        RTL_PROCESS_MODULES SysModules = &#123; 0 &#125;;</span><br><span class="line">        PRTL_PROCESS_MODULES pModules = &amp;SysModules;</span><br><span class="line">        ULONG SystemInformationLength = 0;</span><br><span class="line">        //æŸ¥è¯¢ç³»ç»Ÿä¸­æ‰€æœ‰å†…æ ¸æ¨¡å—ï¼Œåº•å±‚ä¹Ÿæ˜¯éå†é“¾è¡¨</span><br><span class="line">        NTSTATUS status = ZwQuerySystemInformation(SystemModuleInformation, pModules, sizeof(RTL_PROCESS_MODULES), &amp;SystemInformationLength);</span><br><span class="line">        if (status == STATUS_INFO_LENGTH_MISMATCH) &#123;</span><br><span class="line">                pModules = ExAllocatePool(NonPagedPool, SystemInformationLength + sizeof(RTL_PROCESS_MODULES));</span><br><span class="line">                RtlZeroMemory(pModules, SystemInformationLength + sizeof(RTL_PROCESS_MODULES));</span><br><span class="line">                status = ZwQuerySystemInformation(SystemModuleInformation, pModules, SystemInformationLength + sizeof(RTL_PROCESS_MODULES), &amp;SystemInformationLength);</span><br><span class="line">                if (!NT_SUCCESS(status)) &#123;</span><br><span class="line">                        ExFreePool(pModules);</span><br><span class="line">                        return 0;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (!strcmp(&quot;ntkrnlpa.exe&quot;, moduleName)) &#123;</span><br><span class="line">                ULONG_PTR ret = pModules-&gt;Modules[0].ImageBase;</span><br><span class="line">                *pModuleSize = pModules-&gt;Modules[0].ImageSize;</span><br><span class="line">                if (SystemInformationLength) &#123;</span><br><span class="line">                        ExFreePool(pModules);</span><br><span class="line">                &#125;</span><br><span class="line">                return ret;</span><br><span class="line">        &#125;</span><br><span class="line">        for (ULONG i = 0; i &lt; pModules-&gt;NumberOfModules; i++) &#123;</span><br><span class="line">                if (strstr(pModules-&gt;Modules[i].FullPathName, moduleName)) &#123;</span><br><span class="line">                        ULONG_PTR ret = pModules-&gt;Modules[i].ImageBase;</span><br><span class="line">                        *pModuleSize = pModules-&gt;Modules[0].ImageSize;</span><br><span class="line">                        if (SystemInformationLength) &#123;</span><br><span class="line">                                ExFreePool(pModules);</span><br><span class="line">                        &#125;</span><br><span class="line">                        //è¿”å›æ¨¡å—åœ°å€</span><br><span class="line">                        return ret;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (SystemInformationLength) &#123;</span><br><span class="line">                ExFreePool(pModules);</span><br><span class="line">        &#125;</span><br><span class="line">        return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PVOID SearchSpecialCode(PVOID pSearchBeginAddr, ULONG ulSearchLength, PUCHAR pSpecialCode, ULONG ulSpecialCodeLength)</span><br><span class="line">&#123;</span><br><span class="line">        PVOID pDestAddr = NULL;</span><br><span class="line">        PUCHAR pBeginAddr = (PUCHAR)pSearchBeginAddr;</span><br><span class="line">        PUCHAR pEndAddr = pBeginAddr + ulSearchLength;</span><br><span class="line">        PUCHAR i = NULL;</span><br><span class="line">        ULONG j = 0;</span><br><span class="line"></span><br><span class="line">        for (i = pBeginAddr; i &lt;= pEndAddr; i++)</span><br><span class="line">        &#123;</span><br><span class="line">                // éå†ç‰¹å¾ç </span><br><span class="line">                for (j = 0; j &lt; ulSpecialCodeLength; j++)</span><br><span class="line">                &#123;</span><br><span class="line">                        // åˆ¤æ–­åœ°å€æ˜¯å¦æœ‰æ•ˆ</span><br><span class="line">                        if (FALSE == MmIsAddressValid((PVOID)(i + j)))</span><br><span class="line">                        &#123;</span><br><span class="line">                                break;</span><br><span class="line">                        &#125;</span><br><span class="line">                        // åŒ¹é…ç‰¹å¾ç </span><br><span class="line">                        if (*(PUCHAR)(i + j) != pSpecialCode[j])</span><br><span class="line">                        &#123;</span><br><span class="line">                                break;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                // åŒ¹é…æˆåŠŸ</span><br><span class="line">                if (j &gt;= ulSpecialCodeLength)</span><br><span class="line">                &#123;</span><br><span class="line">                        pDestAddr = (PVOID)i;</span><br><span class="line">                        break;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return pDestAddr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">VOID UnloadDriver(PDRIVER_OBJECT pDriver)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NTSTATUS DriverEntry(PDRIVER_OBJECT pDriver, PUNICODE_STRING pRegPath)</span><br><span class="line">&#123;</span><br><span class="line">        ULONG sizeofcode = 0;</span><br><span class="line">        ULONG_PTR baseaddr = GetKernelModuleBase(&quot;ntkrnlpa.exe&quot;, &amp;sizeofcode);</span><br><span class="line">        DbgPrintEx(77, 0, &quot;[db]:baseåœ°å€ä¸º:%p\n&quot;, baseaddr);</span><br><span class="line">        DbgPrintEx(77, 0, &quot;[db]:baseé•¿åº¦ä¸º:%p\n&quot;, sizeofcode);</span><br><span class="line">        UCHAR specode[4] = &#123; 0xE8, 0x21, 0x52, 0xFE,0xFF &#125;;</span><br><span class="line">        ULONG_PTR codeaddr = SearchSpecialCode(baseaddr, sizeofcode, specode,5);</span><br><span class="line">        DbgPrintEx(77, 0, &quot;[db]:æ‰¾åˆ°çš„ä»£ç åœ°å€ä¸º:%p\n&quot;, codeaddr);</span><br><span class="line">        ULONG_PTR uGetPspGet = (*(PULONG)((PUCHAR)codeaddr - 6 + 2));</span><br><span class="line">        DbgPrintEx(77, 0, &quot;[db]:å…¨å±€å¥æŸ„è¡¨çš„åœ°å€ä¸º:%p\n&quot;, uGetPspGet);</span><br><span class="line">        pDriver-&gt;DriverUnload = UnloadDriver;</span><br><span class="line">        return STATUS_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



]]></content>
  </entry>
  <entry>
    <title>GPTç½‘ç«™é—®ç­”æµç¨‹é€†å‘å’ŒPythonå¤ç°</title>
    <url>/2023/05/12/GPT%E7%BD%91%E7%AB%99%E9%97%AE%E7%AD%94%E6%B5%81%E7%A8%8B%E9%80%86%E5%90%91%E5%92%8CPython%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h2 id="é€†å‘åˆ†æ"><a href="#é€†å‘åˆ†æ" class="headerlink" title="é€†å‘åˆ†æ"></a>é€†å‘åˆ†æ</h2><p>F12æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œè¾“å…¥é—®é¢˜ï¼Œç‚¹å‡»å‘é€ï¼ŒæŸ¥çœ‹Networkè®°å½•</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://s1.ax1x.com/2023/05/05/p9NsS41.png"
                     
                ></p>
<p>å‘ç°æœ‰ä¸¤æ¡è¯·æ±‚ï¼Œç¬¬ä¸€æ¡æ˜¯æ™®é€šçš„XMLHttpRequestï¼Œç¬¬äºŒæ¡æ˜¯ä¸€ä¸ªstreamæµï¼Œè”æƒ³åˆ°ç½‘ç«™æ˜¾ç¤ºå›ç­”æ—¶é€šå¸¸ä¸€ä¸ªå­—ä¸€ä¸ªå­—é€æ­¥æ˜¾ç¤ºï¼Œå›ç­”åº”è¯¥å°±æ˜¯é€šè¿‡streamæµä¼ è¾“çš„</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://s1.ax1x.com/2023/05/05/p9NsC36.png"
                     
                ></p>
<p>æŸ¥çœ‹è¯¥æµï¼Œæœç„¶å°†ç­”æ¡ˆæ‹†å¼€ä¼ è¾“ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„ç›®æ ‡è¯·æ±‚äº†ï¼Œè§‚å¯Ÿstreamæµè¯·æ±‚ï¼š</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://s1.ax1x.com/2023/05/05/p9NyUdH.png"
                     
                ></p>
<p>è¿™æ ·çš„ä¸å¸¦å‚æ•°çš„getè¯·æ±‚å¦‚ä½•ä½¿æœåŠ¡ç«¯ç¡®å®šé—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼ŒçŒœæµ‹ç½‘ç«™å¯¹cookieè¿›è¡Œäº†æ“ä½œï¼ŒæŸ¥çœ‹ä¸¤æ¡è¯·æ±‚çš„cookieï¼š</p>
<p>1.submitçš„cookie</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://s1.ax1x.com/2023/05/05/p9NsPgK.png"
                     
                ></p>
<p>2.streamçš„cookie</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://s1.ax1x.com/2023/05/05/p9NrjHJ.png"
                     
                ></p>
<p>å‘ç°åœ¨submitåï¼Œå“åº”ä½“è®¾ç½®äº†æ–°çš„cookieï¼š<code>session</code>ï¼Œå› æ­¤åªè¦è·å–è¯¥sessionçš„cookieå€¼ï¼Œå°±å¯ä»¥ç¼–å†™è¯·æ±‚ç´¢å–GPTçš„å›ç­”ã€‚ä¸ºäº†è·å–sessionå€¼ï¼Œåˆ™éœ€è¦å…ˆå‘é€submitè¯·æ±‚ï¼Œè§‚å¯Ÿè¯¥è¯·æ±‚ï¼Œå‘ç°è¿™æ˜¯ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œé€šè¿‡Payloadçš„æ–¹å¼ä¸Šä¼ æ•°æ®</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://s1.ax1x.com/2023/05/05/p9Ns99x.png"
                     
                ></p>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼š<code>his</code>å’Œ<code>prompt</code>ï¼Œpromptå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯å‘é€çš„é—®é¢˜ï¼Œæ­¤å¤„è¿›è¡Œäº†åŠ å¯†å¤„ç†ï¼Œhisæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå¤§æ¦‚ç‡æ˜¯å†å²è®°å½•ï¼ˆè¯¥GPTæœ‰æ ¹æ®ä¸Šæ–‡å›ç­”é—®é¢˜çš„åŠŸèƒ½ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆåˆ†æpromptçš„ç”Ÿæˆ</p>
<p>è§‚å¯Ÿåˆ°submitè¯·æ±‚çš„Initiatoræ˜¯main.jsï¼Œç›´æ¥åˆ°è¯¥æ–‡ä»¶ä¸­æœç´¢â€promptâ€ï¼Œå‘ç°å¹¶æ²¡æœ‰ç»“æœ</p>
<p>è§‚å¯Ÿmain.jsï¼Œå‘ç°æ˜¯åŠ å¯†æ··æ·†è¿‡çš„ï¼Œå…¶ä¸­æœ‰å¤§é‡çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²å’Œä¸€å †æ¯«æ— æ„ä¹‰çš„åç§»å’Œå‡½æ•°</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://s1.ax1x.com/2023/05/05/p9NrxE9.png"
                     
                ></p>
<p>æŠŠæ–‡ä»¶é€å…¥è§£å¯†ç½‘ç«™ï¼ŒæŠŠä»£ç è¿›è¡Œè§£ç ï¼Œå†æ¬¡æœç´¢â€promptâ€</p>
<p>æˆåŠŸå®šä½åˆ°äº†ä½ç½®ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">var W = input_value;  // è¾“å…¥çš„é—®é¢˜å­—ç¬¦ä¸²</span><br><span class="line">document[n(zZ.Xb, 0x145, zZ.js, zZ.XR) + &#x27;Ele&#x27; + n(0x1de, 0x30e, &#x27;z$N#&#x27;, 0x1e2) + &#x27;tBy&#x27; + &#x27;Id&#x27;](I[d(zZ.Xm, zZ.XV, 0x25, -zZ.XM) + &#x27;kc&#x27;])[d(zZ.XO, zZ.XH, 0x45, 0x154) + &#x27;ue&#x27;] = &#x27;&#x27;;</span><br><span class="line">var y = I[d(zZ.Xt, zZ.XQ, -0x147, zZ.Xe) + &#x27;SF&#x27;](P, W);</span><br><span class="line">D[n(0x1b5, zZ.um, &#x27;YS3C&#x27;, 0x114) + &#x27;d&#x27;](JSON[d(&#x27;5l3F&#x27;, -0xef, -zZ.XT, -0x20f) + n(zZ.Xl, 0x174, &#x27;jHS6&#x27;, -zZ.Xs) + n(0xea, zZ.XZ, zZ.Xa, -zZ.XG)](&#123;</span><br><span class="line">    &#x27;prompt&#x27;: y,</span><br><span class="line">    &#x27;his&#x27;: window[n(zZ.XJ, -0x2, &#x27;2Qf[&#x27;, 0x74) + d(&#x27;[qgO&#x27;, -zZ.XF, -zZ.Xr, -zZ.jz) + &#x27;ys&#x27;][n(zZ.Xc, 0x154, &#x27;i2$#&#x27;, 0x1bc) + d(zZ.Xv, -zZ.XE, -zZ.Xh, -0x2ad)] &lt;= 0x1d * 0x76 + 0x18f2 + -0xcc5 * 0x3 || !document[n(0x1e, -zZ.Xn, &#x27;xt$S&#x27;, zZ.Xd) + &#x27;Ele&#x27; + n(0x8, -0x3e, &#x27;5l3F&#x27;, zZ.XK) + n(zZ.XL, -0x57, &#x27;8UZA&#x27;, zZ.S0) + &#x27;Id&#x27;](I[d(zZ.S1, -0x1cb, -0x311, -0x7f) + &#x27;pZ&#x27;])[n(0x1fe, zZ.S2, &#x27;2Qf[&#x27;, zZ.S3) + &#x27;cke&#x27; + &#x27;d&#x27;] ? [] : window[d(zZ.S4, -0x22a, -zZ.S5, -zZ.S6) + n(zZ.ja, -zZ.S7, zZ.u0, 0x18c) + &#x27;ys&#x27;]</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure></div>

<p>æ•´ä¸ªä»£ç éƒ½è¢«æ··æ·†äº†ï¼Œä½†ä¾ç¨€è¿˜èƒ½è§åˆ°ä¸€äº›å½±å­ï¼Œæ¯”å¦‚ç¬¬äºŒè¡Œä¸­èƒ½æ‹¼å‡‘å‡ºç†Ÿæ‚‰çš„<code>ElementById</code></p>
<p>è¿™é‡Œèƒ½å‘ç°ï¼Œpromptå€¼å°±æ˜¯yï¼Œè€Œhisçš„å€¼åˆ™æ˜¯å…ˆæ¯”è¾ƒäº†<code>historyCheck</code>çš„å€¼ï¼Œå¦‚æœé€‰æ‹©äº†åˆ™ä¸ºåˆ—è¡¨å€¼ï¼Œæœªé€‰æ‹©åˆ™ä¸ºç©ºåˆ—è¡¨<code>[]</code></p>
<p>é‡ç‚¹åœ¨yçš„è®¡ç®—ä¸Šï¼Œæ­¤å¤„æ‰“ä¸Šæ–­ç‚¹ï¼Œé‡æ–°å‘é€ï¼Œå®šä½åˆ°è¯¥å‡½æ•°çš„ä½ç½®ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;\x5a\x41\x7a\x53\x46&#x27;: function(x, U) &#123;</span><br><span class="line">    return x(U);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div>

<p>å³:</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">var y = P(W);</span><br></pre></td></tr></table></figure></div>

<p>è·³è½¬åˆ°å‡½æ•°Pï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">function P(x) &#123;</span><br><span class="line">    var zf = &#123;</span><br><span class="line">        I: 0x23,</span><br><span class="line">        P: 0x159</span><br><span class="line">    &#125;;</span><br><span class="line">    const U = CryptoJS[K(zw.I, zw.P, zw.D, 0x634)][K(zw.W, zw.y, zw.x, 0x5f7) + &#x27;8&#x27;][L(-0x172, -0x1a6, zw.U, -0x1cd) + &#x27;se&#x27;](I[K(0x4f8, zw.p, zw.f, 0x348) + &#x27;DP&#x27;]);</span><br><span class="line"></span><br><span class="line">    function K(I, P, D, W) &#123;</span><br><span class="line">        return d(P, I - zp.I, D - zp.P, W - zp.D);</span><br><span class="line">    &#125;</span><br><span class="line">    const p = CryptoJS[L(zw.w, -zw.C, &#x27;Oh0s&#x27;, -0x88)][K(0x57a, &#x27;8Xtv&#x27;, 0x689, 0x522) + &#x27;8&#x27;][L(-0x3a, -0xf1, &#x27;TyCN&#x27;, zw.k) + &#x27;se&#x27;](I[L(-0xec, 0x78, zw.N, -zw.B) + &#x27;gQ&#x27;]);</span><br><span class="line">    let f = CryptoJS[L(-0x29a, -zw.q, &#x27;!mzD&#x27;, -zw.Y)][K(zw.A, zw.zC, zw.zk, zw.zN) + &#x27;ryp&#x27; + &#x27;t&#x27;](x, U, &#123;</span><br><span class="line">        &#x27;iv&#x27;: p,</span><br><span class="line">        &#x27;mode&#x27;: CryptoJS[K(zw.zB, zw.zq, zw.zY, 0x208) + &#x27;e&#x27;][K(zw.zA, &#x27;ui19&#x27;, zw.zb, zw.zR)],</span><br><span class="line">        &#x27;padding&#x27;: CryptoJS[K(zw.zm, zw.zV, 0x600, 0x58c)][L(-zw.zM, -zw.zO, zw.zH, -0x11) + K(0x4b5, zw.zt, 0x65a, zw.zQ) + L(zw.ze, -zw.zT, zw.zl, -zw.zs) + &#x27;ng&#x27;]</span><br><span class="line">    &#125;)[&#x27;toS&#x27; + L(zw.zZ, 0x52, &#x27;AO11&#x27;, -zw.za) + &#x27;ng&#x27;]();</span><br><span class="line">    console[K(zw.zG, zw.zJ, 0x3ed, 0x48f)](f);</span><br><span class="line"></span><br><span class="line">    function L(I, P, D, W) &#123;</span><br><span class="line">        return d(D, W - -zf.I, D - 0x2b, W - zf.P);</span><br><span class="line">    &#125;</span><br><span class="line">    return f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>çœ‹åˆ°CryptoJSå…³é”®å­—å°±çŸ¥é“ï¼ŒåŸæ¥æ˜¯è€æœ‹å‹AESåŠ å¯†ï¼ŒåŠ å¯†ä»£ç ä¸€èˆ¬é•¿è¿™æ ·ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">let f = CryptoJS.AES.encrypt(data, key, &#123;</span><br><span class="line">    &#x27;iv&#x27;: iv,</span><br><span class="line">    &#x27;mode&#x27;: CryptoJS.mode.CBC,</span><br><span class="line">    &#x27;padding&#x27;: CryptoJS.pad.ZeroPadding</span><br><span class="line">&#125;).toString();</span><br></pre></td></tr></table></figure></div>

<p>å› æ­¤ï¼Œåªéœ€è¦çŸ¥é“æ˜æ–‡<code>data</code>ï¼Œåç§»é‡<code>iv</code>ï¼Œå¯†é’¥<code>key</code>ï¼ŒåŠ å¯†æ¨¡å¼<code>mode</code>å’Œ<code>padding</code>æ¨¡å¼å°±èƒ½ç®—å‡ºå¯†æ–‡</p>
<p>å°†æ··æ·†çš„ä»£ç å‡½æ•°ç‰‡æ®µæ‹–å…¥consoleä¸­è¿è¡Œï¼Œé€æ­¥å¾—åˆ°å…³é”®ä¿¡æ¯ï¼Œå°†ä»£ç ç®€åŒ–åå¯ä»¥å¾—åˆ°ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">function P(x) &#123;</span><br><span class="line">    const U = CryptoJS.enc.Utf8.parse(&#x27;y~.,ZaabH6Ri?L7*&#x27;);</span><br><span class="line">    const p = CryptoJS.enc.Utf8.parse(&#x27;koJ)KZhR1RW)!_~M&#x27;);</span><br><span class="line">    let f = CryptoJS.AES.encrypt(x, U, &#123;</span><br><span class="line">        &#x27;iv&#x27;: p,</span><br><span class="line">        &#x27;mode&#x27;: CryptoJS.mode.CBC,</span><br><span class="line">        &#x27;padding&#x27;: CryptoJS.pad.ZeroPadding</span><br><span class="line">    &#125;).toString();</span><br><span class="line">    return f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>è¿™æ ·å°±ä¸€ç›®äº†ç„¶äº†ï¼Œä»¥æ­¤å³å¯å¤ç°æ•´ä¸ªé—®ç­”æµç¨‹</p>
<h2 id="è„šæœ¬å¤ç°"><a href="#è„šæœ¬å¤ç°" class="headerlink" title="è„šæœ¬å¤ç°"></a>è„šæœ¬å¤ç°</h2><p>æœ‰äº†åŠ å¯†æ–¹å¼ï¼Œä¾¿å°è¯•ä½¿ç”¨pythonå¤ç°è¯¥è¿‡ç¨‹ï¼Œ</p>
<p>æ‰€éœ€åº“ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line">requests</span><br><span class="line">BeautifulSoup4</span><br><span class="line">pycryptodome</span><br></pre></td></tr></table></figure></div>

<p>å®Œæ•´ä»£ç ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=gbk</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup <span class="keyword">as</span> bs</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prompt</span>(<span class="params">text</span>):</span><br><span class="line">    key = <span class="string">&quot;y~.,ZaabH6Ri?L7*&quot;</span>.zfill(<span class="number">16</span>).encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    iv = <span class="string">&quot;koJ)KZhR1RW)!_~M&quot;</span>.zfill(<span class="number">16</span>).encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    temp = <span class="string">b&quot;&quot;</span></span><br><span class="line">    data = text.encode()</span><br><span class="line">    data = data + <span class="string">&quot;\0&quot;</span>.encode() * (<span class="number">16</span> - <span class="built_in">len</span>(data) % <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(<span class="built_in">len</span>(data) / <span class="number">16</span>)):</span><br><span class="line">        block = data[<span class="number">16</span> * i: <span class="number">16</span> * (i + <span class="number">1</span>)]</span><br><span class="line">        b = cipher.encrypt(block)</span><br><span class="line">        temp += b</span><br><span class="line">    res = base64.b64encode(temp).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">submit</span>(<span class="params">pro, his</span>):</span><br><span class="line">    url = <span class="string">&quot;https://gpt.tool00.com/api/v1/chat/submit&quot;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>,</span><br><span class="line">        <span class="string">&quot;accept-encoding&quot;</span>: <span class="string">&quot;gzip, deflate, br&quot;</span>,</span><br><span class="line">        <span class="string">&quot;accept-language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">        <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;cookie&quot;</span>: <span class="string">&quot;_ga=GA1.1.800331461.1681885375; FCNEC=%5B%5B%22AKsRol9hmarvKjjCFyL8FNDRa4pULxPROMocI7VYSD0RbFdjyJTZC7l-bg8X9jiqb_sgT20JjKZUcByZcxCISeOtpn6yrS-MfP7fBKq_bnxmfgqatIjGyGj94fs7mzCuRdhlqjb3wptJRkxJW7PtMVyBrDHMULZplA%3D%3D%22%5D%2Cnull%2C%5B%5D%5D; __gads=ID=687486c546a2283f-22c4ae5397e0000b:T=1683182853:RT=1683182853:S=ALNI_MZCmtWOxQGyc3bhufEj8nnhyv6Pqg; __gpi=UID=00000c01738ff6e2:T=1683182853:RT=1683182853:S=ALNI_MZfy93-Hs1rY1R4PPrdQzg6CqPS3w; _ga_60RX9FESNC=GS1.1.1683187497.3.0.1683187497.0.0.0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;origin&quot;</span>: <span class="string">&quot;https://gpt.tool00.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;referer&quot;</span>: <span class="string">&quot;https://gpt.tool00.com/&quot;</span>,</span><br><span class="line">        <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;prompt&quot;</span>: pro,</span><br><span class="line">        <span class="string">&quot;his&quot;</span>: his</span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.post(url, headers=headers, data=json.dumps(data))</span><br><span class="line">    session = re.search(<span class="string">&quot;[0-9a-z]&#123;8&#125;-[0-9a-z]&#123;4&#125;-[0-9a-z]&#123;4&#125;-[0-9a-z]&#123;4&#125;-[0-9a-z]&#123;12&#125;&quot;</span>, r.headers[<span class="string">&quot;set-cookie&quot;</span>])</span><br><span class="line">    <span class="keyword">return</span> session.group()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stream</span>(<span class="params">session</span>):</span><br><span class="line">    url = <span class="string">&quot;https://gpt.tool00.com/api/v1/chat/stream&quot;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>,</span><br><span class="line">        <span class="string">&quot;accept-encoding&quot;</span>: <span class="string">&quot;gzip, deflate, br&quot;</span>,</span><br><span class="line">        <span class="string">&quot;accept-language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">        <span class="string">&quot;cache-control&quot;</span>: <span class="string">&quot;no-cache&quot;</span>,</span><br><span class="line">        <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;cookie&quot;</span>: <span class="string">&quot;_ga=GA1.1.800331461.1681885375; FCNEC=%5B%5B%22AKsRol9hmarvKjjCFyL8FNDRa4pULxPROMocI7VYSD0RbFdjyJTZC7l-bg8X9jiqb_sgT20JjKZUcByZcxCISeOtpn6yrS-MfP7fBKq_bnxmfgqatIjGyGj94fs7mzCuRdhlqjb3wptJRkxJW7PtMVyBrDHMULZplA%3D%3D%22%5D%2Cnull%2C%5B%5D%5D; __gads=ID=687486c546a2283f-22c4ae5397e0000b:T=1683182853:RT=1683182853:S=ALNI_MZCmtWOxQGyc3bhufEj8nnhyv6Pqg; __gpi=UID=00000c01738ff6e2:T=1683182853:RT=1683182853:S=ALNI_MZfy93-Hs1rY1R4PPrdQzg6CqPS3w; _ga_60RX9FESNC=GS1.1.1683187497.3.0.1683187497.0.0.0; session=&quot;</span> + session,</span><br><span class="line">        <span class="string">&quot;origin&quot;</span>: <span class="string">&quot;https://gpt.tool00.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;referer&quot;</span>: <span class="string">&quot;https://gpt.tool00.com/&quot;</span>,</span><br><span class="line">        <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.get(url, headers=headers)</span><br><span class="line">    b = bs(r.content, <span class="string">&quot;lxml&quot;</span>)</span><br><span class="line">    extr = re.findall(<span class="string">&#x27;&quot;content&quot;: &quot;.*&quot;&#x27;</span>, <span class="built_in">str</span>(b))</span><br><span class="line">    ans = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i, n <span class="keyword">in</span> <span class="built_in">enumerate</span>(extr):</span><br><span class="line">        <span class="keyword">if</span> i &gt;= <span class="number">1</span>:</span><br><span class="line">            ans += n[<span class="number">12</span>:-<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&gt;&gt; &quot;</span> + ans.encode(<span class="string">&quot;utf-8&quot;</span>).decode(<span class="string">&#x27;unicode_escape&#x27;</span>))</span><br><span class="line"></span><br><span class="line">history = []</span><br><span class="line"><span class="keyword">while</span> (text := <span class="built_in">input</span>(<span class="string">&quot;&gt;&gt; &quot;</span>)):</span><br><span class="line">    <span class="keyword">if</span> text != <span class="string">&quot;exit&quot;</span>:</span><br><span class="line">        stream(submit(prompt(text), history))</span><br><span class="line">        history.append(text)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure></div>

]]></content>
  </entry>
  <entry>
    <title>å°è¯•æ¸¸æˆè¾…åŠ©ç ´è§£</title>
    <url>/2023/05/13/%E5%B0%9D%E8%AF%95%E6%9F%90%E6%B8%B8%E6%88%8F%E8%BE%85%E5%8A%A9%E7%A0%B4%E8%A7%A3/</url>
    <content><![CDATA[<h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p><strong>æˆ‘çš„ä¸€ä½æœ‹å‹</strong>å†³å®šåœ¨ç½‘ä¸Šè´­ä¹°ä¸€ä¸ªæ¸¸æˆè¾…åŠ©ï¼Œä»¥æé«˜è‡ªå·±åœ¨æ¸¸æˆä¸­çš„è¡¨ç°ã€‚ä»–å‘ç°äº†ä¸€ä¸ªä»·æ ¼ç›¸å¯¹ä¾¿å®œçš„å–å®¶ï¼Œäºæ˜¯ç«‹å³ä¸‹å•è´­ä¹°äº†è¯¥è¾…åŠ©ã€‚</p>
<p><strong>ç„¶è€Œ</strong>ï¼Œå½“è¾…åŠ©åˆ°æ‰‹åï¼Œä»–å¾ˆå¿«å°±å‘ç°å®ƒè¿˜éœ€è¦é¢å¤–è´­ä¹°ç‚¹å¡ã€‚äºæ˜¯ä»–è”ç³»äº†å–å®¶ï¼Œå–å®¶å‘Šè¯‰ä»–éœ€è¦æŒ‰ç…§ä¸€å®šçš„æ–¹æ³•ä½¿ç”¨è¾…åŠ©ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™äº›æ–¹æ³•æ˜¯æ ¹æœ¬è¡Œä¸é€šçš„ã€‚</p>
<p>ä»–æƒŠéª‡åœ°å‘ç°è‡ªå·±<em><strong>è¢«éª—äº†</strong></em>ï¼Œå› ä¸ºé‚£ä¸ªå–å®¶æ—©åœ¨å–å‡ºä¹‹å‰å°±çŸ¥é“è¿™ä¸ªæ¸¸æˆè¾…åŠ©<strong>éœ€è¦é¢å¤–æ”¶è´¹</strong>ã€‚æˆ‘çš„æœ‹å‹ç»è¿‡ä¸€ç•ªåŠªåŠ›ï¼Œè¯•å›¾è¦æ±‚é€€æ¬¾ï¼Œä½†æ˜¯å–å®¶å´ä»¥å„ç§ç†ç”±æ‹’ç»äº†ä»–çš„é€€æ¬¾è¦æ±‚ã€‚</p>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘çš„æœ‹å‹æ‡Šæ¼ä¸‡åˆ†ã€‚ä»–çš„é’±è´¢ä»˜è¯¸ä¸œæµï¼ŒåŒæ—¶è‡ªå·±è¿˜èŠ±è´¹äº†å¾ˆå¤šæ—¶é—´å’Œç²¾åŠ›ï¼Œè€Œæœ€ç»ˆå´æ¯«æ— æ‰€è·ã€‚ä»–æ·±æ·±åœ°æ„è¯†åˆ°ï¼Œå­¦ä¹ ç ´è§£è½¯ä»¶æ˜¯å¤šä¹ˆæœ‰åŠ©äºå­¦ä¹ å’ŒæŠ€æœ¯æˆé•¿ã€‚<strong>ä»–çœŸçš„ æˆ‘å“­æ­»ğŸ˜­</strong></p>
<div class="highlight-container" data-rel="Ps"><figure class="iseeu highlight ps"><table><tr><td class="code"><pre><span class="line">ğŸ˜Šè¯·ä¸è¦åœ¨è”ç½‘æ¸¸æˆä¸­ä½¿ç”¨æ¸¸æˆè¾…åŠ©ï¼Œå®ƒä»¬é€šå¸¸ç ´åæ¸¸æˆå¹³è¡¡ï¼ŒæŸå®³ä»–äººæ¸¸æˆä½“éªŒæˆ–è€…å¯¼è‡´è‡ªå·±è´¦å·è¢«å°ã€‚</span><br><span class="line">ğŸ˜˜ä¿æŒæ¸¸æˆçš„å…¬æ­£ä¸ä¹è¶£ï¼Œè¿œç¦»æ¸¸æˆè¾…åŠ©ï¼</span><br><span class="line">        ğŸ¤œä»»ä½•é‚ªæ¶ ç»ˆå°†è¢«ç»³ä¹‹ä»¥æ³•ğŸ¤›</span><br></pre></td></tr></table></figure></div>

<h2 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h2><p>æŠŠæ¸¸æˆè¾…åŠ©æ‹–è¿›PeidæŸ¥å£³,å—¯ æ— å£³ ï¼Œè¾…åŠ©ä½œè€…æ¯”è¾ƒè‡ªä¿¡</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/13/BrpXZL29.png"
                     
                ></p>
<p>ä¸å¤šbbï¼Œæ‹–è¿›OllyDBGå¼€æ(æˆ–è€…X64dbg)ï¼Œè¯•ç€è¿è¡Œä¸€ä¸‹å­ï¼Œç‚¹å‡»ç™»å½•ï¼Œå‡ºç°ä¸€ä¸ªå¼¹çª—</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/13/EAf52t7Z.png"
                     
                ></p>
<p>å³é”®å°è¯•æœç´¢ä¸‹å­—ç¬¦ä¸²å‘ç°æœ‰â€œåŠ å…¥é»‘åå•â€ï¼Œå…ˆè¿›å»ä¸‹å‡ ä¸ªæ–­ç‚¹</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/13/SifhWiCl.png"
                     
                ></p>
<p>å¾€ä¸‹ç¿»  å‘ç°è¾…åŠ©ä½œè€…</p>
<p><strong>å¾ˆæ²¡ç´ è´¨</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/13/DIzLAbVx.png"
                     
                ></p>
<p>å› ä¸ºæœ‰å¼¹çª—ï¼Œæ‰€ä»¥ç›´æ¥ä¸‹ä¸€ä¸ªå¼¹çª—ä½“çš„æ–­ç‚¹</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/13/jQdyLfk5.png"
                     
                ></p>
<p>ç™»é™†æ–­ä¸‹æ¥äº†ï¼Œå› ä¸ºæ˜¯ç³»ç»Ÿé¢†ç©º</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/13/gBqetTP0.png"
                     
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/13/hqXflFOF.png"
                     
                ></p>
<p>å³ä¸‹è§’çª—å£å¤„æœ‰ä¸ª â€è¿”å›åˆ°â€œ å³é”®å®ƒ â€åæ±‡ç¼–çª—å£è·Ÿéšâ€œ</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/13/CHyGMoJ7.png"
                     
                ></p>
<p>è¯´æ˜åˆšåˆšä»ä¸Šé¢è¿™ä¸ªcallå‡ºæ¥ï¼Œè¿™ä¸ªcallå°±æ˜¯å¼¹å‡ºå¯†ç é”™è¯¯çš„callï¼Œè¯´æ˜éªŒè¯è‚¯å®šåœ¨å‰é¢ã€‚</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/13/MXbcmNUE.png"
                     
                ></p>
<p>è¿™ä¸æ˜¯åˆšåˆšé‚£ä¸ªéª‚äººçš„å— å¾€ä¸Šä¸€ç¿» è¿˜çœŸæ˜¯ï¼Œè¿™ä¸ªé”™è¯¯callä¸Šé¢æœ‰jmpå¯ä»¥è·³è¿‡</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/13/42Z962on.png"
                     
                ></p>
<p>å…ˆå¾€ä¸Šçœ‹çœ‹å®ƒæ€ä¹ˆèµ°çš„</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/13/MaCRHrrY.png"
                     
                ></p>
<p>è¿™é‡Œå³å¥è½¬åˆ°ä¸Šé¢çš„è·³è½¬00414AB7</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/13/G3hj50Yu.png"
                     
                ></p>
<p>åœ¨è¿™é‡Œä¸‹ä¸ªæ–­ç‚¹ï¼Œç„¶åæŠŠåˆšåˆšä¸‹çš„çª—å£æ–­ç‚¹åˆ é™¤</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/13/iNtbZi4r.png"
                     
                ></p>
<p>å·²ç»æ²¡ç”¨äº†ï¼ŒF9è¿è¡Œè½¯ä»¶ï¼Œç‚¹å‡»ç™»å½•ï¼Œæ–­ä½äº†</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/13/LWDtMhre.png"
                     
                ></p>
<p>ä¸èƒ½è®©ä»–ä¸‹å» ä¸ç„¶ä¸å°±å›åˆ°é”™è¯¯calläº† ç›´æ¥nopæ‰</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/14/JDvqdjxA.png"
                     
                ></p>
<p>æ¥ç€æŒ‰f8 ä¸€æ­¥ä¸€æ­¥è·Ÿç€ï¼Œèµ°åˆ°è¿™é‡Œ</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/14/0VsxFJLB.png"
                     
                ></p>
<p>å‘ç°ä¸€ä¸ªå¤§è·³ï¼Œåˆ°ç»ˆç‚¹çœ‹ä¸€çœ‹</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/14/wpi7Z8ZC.png"
                     
                ></p>
<p>é˜¿è¿™  </p>
<p>è¿™è·³ä¸‹å»è¦æŒ¨éª‚äº† æ‰€ä»¥å’±ä»¬å›å» æŠŠåˆšåˆšé‚£ä¸ªè·³è½¬nopæ‰</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/14/usqzKd4n.png"
                     
                ></p>
<p>ç»§ç»­å¾€ä¸‹f8 èµ°åˆ°è¿™é‡Œ å†èµ°ä¸€æ­¥</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/14/GFEQSe0M.png"
                     
                ></p>
<p>ç¨‹åºè‡ªæ€äº†</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/14/skPjX1so.png"
                     
                ></p>
<p>ä¼°è®¡æ˜¯è¾…åŠ©ä½œè€…ç•™ä¸‹çš„ æš—åº„  å›åˆ°åˆšåˆšæ­»æ‰çš„ä½ç½®æ ‡è®°ä¸€ä¸‹ï¼Œä¸‹ä¸ªæ–­ç‚¹ é‡æ–°è¿è¡Œç¨‹åº æŒ‰f7è¿›è‡ªæ€call</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/14/lXn3thYL.png"
                     
                ></p>
<p>f8ç»§ç»­ä¸‹å» èµ°åˆ°è¿™ä¸ªcallï¼Œç¨‹åºåˆè‡ªæ€äº† åˆšå¥½ä¸Šé¢é‚£ä¸ªå¤§è·³èƒ½è·³è¿‡è¿™ä¸ªè‡ªæ€call</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/14/i6TIMzMI.png"
                     
                ></p>
<p>é‡æ–°è¿è¡Œåˆ°åˆšåˆšé‚£é‡Œ jgeæ”¹æˆjmp</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/14/V0GGiXPZ.png"
                     
                ></p>
<p>ç»§ç»­f8å¾€ä¸‹ è¿™ä¸ªcallæœ‰ç‚¹çœ¼ç†Ÿé˜¿</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/14/zd7G6elo.png"
                     
                ></p>
<p>å¥½åƒæ˜¯ä¸Šé¢é‚£ä¸ªè‡ªæ€call  æœç„¶ä¸€æ ·</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/14/o0Mvd40j.png"
                     
                ></p>
<p>ç›´æ¥æ”¹æˆjmp f8ç»§ç»­å¾€ä¸‹æ¥ç€èµ°ä¸€ä¼šå„¿ï¼Œå‘ç°ä»åˆšåˆšçš„è‡ªæ€callå‡ºæ¥äº†</p>
<p>f8å†æ¥ç€å¾€ä¸‹èµ°ï¼Œç¨‹åºå°±å¼¹å‡º</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/14/LAVi8cqH.png"
                     
                ></p>
<h2 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p>æ—¶é—´å˜æˆäº†-1ç§’ï¼Œç ´è§£åˆ°æ­¤å°±æˆåŠŸäº†ï¼Œæ‰“å¼€è½¯ä»¶åå°±å¯ä»¥ç›´æ¥è¿›å…¥è¾…åŠ©ç•Œé¢</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://img1.imgtp.com/2023/05/14/dbR5oWmq.png"
                     
                ></p>
]]></content>
  </entry>
</search>
